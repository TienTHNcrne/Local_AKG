/** @format */
import React, { useEffect, useState } from "react";
import axios from "axios";
import styles from "./TinhHoa.module.scss";
import Place from "./components/Place/Place";

export default function TinhHoa() {
    const [keyword, setKeyword] = useState("");
    const [filter, setFilter] = useState("All");
    const [data, setData] = useState([]);
    const [form, setForm] = useState("place"); // tab hi·ªán t·∫°i

    useEffect(() => {
        const fetchData = async () => {
            try {
                const res = await axios.get(
                    `${import.meta.env.VITE_BE_URL}/v1/api/gps/all`
                );
                setData(res.data);
            } catch (err) {
                console.error("L·ªói khi fetch:", err.message);
            }
        };
        fetchData();
    }, []);

    // L·ªçc d·ªØ li·ªáu theo keyword + filter
    const filteredData = data.filter((item) => {
        const name = item.name?.toLowerCase() || "";
        const category = item.category?.toLowerCase() || "";
        const desc = item.description?.toLowerCase() || "";
        const key = keyword.toLowerCase();

        const matchKeyword =
            name.includes(key) || category.includes(key) || desc.includes(key);

        const matchFilter =
            filter === "All" ||
            item.category?.toLowerCase() === filter.toLowerCase();

        return matchKeyword && matchFilter;
    });

    return (
        <div className={styles.container}>
            {/* Tabs ch·ªçn form */}
            <div className={styles.tabs}>
                <button
                    className={form === "place" ? styles.active : ""}
                    onClick={() => setForm("place")}
                >
                    ƒê·ªãa ƒëi·ªÉm
                </button>
                <button
                    className={form === "food" ? styles.active : ""}
                    onClick={() => setForm("food")}
                >
                    M√≥n ƒÉn
                </button>
                <button
                    className={form === "event" ? styles.active : ""}
                    onClick={() => setForm("event")}
                >
                    S·ª± ki·ªán
                </button>
            </div>

            {/* Search + Filter */}
            <div className={styles.header}>
                <div className={styles.second}>
                    <input
                        type="text"
                        placeholder="T√¨m ki·∫øm..."
                        value={keyword}
                        onChange={(e) => setKeyword(e.target.value)}
                    />
                    {form === "place" && (
                        <div className={styles.filter}>
                            <select
                                name="filter"
                                value={filter}
                                onChange={(e) => setFilter(e.target.value)}
                            >
                                <option value="All">T·∫•t c·∫£</option>
                                <option value="Di t√≠ch l·ªãch s·ª≠">
                                    Di t√≠ch l·ªãch s·ª≠
                                </option>
                                <option value="Du l·ªãch t√¢m linh">
                                    Du l·ªãch t√¢m linh
                                </option>
                                <option value="Danh lam th·∫Øng c·∫£nh">
                                    Danh lam th·∫Øng c·∫£nh
                                </option>
                                <option value="·∫®m th·ª±c">·∫®m th·ª±c</option>
                            </select>
                        </div>
                    )}
                </div>
            </div>

            {/* Render theo form */}
            {form === "place" && (
                <Place
                    setKeyword={setKeyword}
                    setFilter={setFilter}
                    keyword={keyword}
                    filter={filter}
                    filteredData={filteredData}
                />
            )}
            {form === "food" && <p>üìå Danh s√°ch m√≥n ƒÉn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y.</p>}
            {form === "event" && <p>üìå Danh s√°ch s·ª± ki·ªán s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y.</p>}
        </div>
    );
}
